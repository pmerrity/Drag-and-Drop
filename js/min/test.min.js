function dragenter(e){e.stopPropagation(),e.preventDefault()}function dragover(e){e.stopPropagation(),e.preventDefault()}function drop(e){e.stopPropagation(),e.preventDefault();for(var n=e.dataTransfer.files,t=0;t<n.length;t++)handleFiles(n[t])}function handleFiles(e){function n(){console.log(t.size/1e6+"+ MB"),console.log(t.type),console.log(t.name);var e=document.getElementById("dropListing"),n=document.createElement("img");n.classList.add("obj"),n.setAttribute("id","dat"),n.file=t,e.appendChild(n);var a=new FileReader;a.onload=function(e){return function(n){e.src=n.target.result}}(n),a.readAsDataURL(t),saveImageToS3(t),$("#selectFile").click(function(){console.log("click"),saveImageToS3(),sendFile(t)})}var t=e;t.size<2097152?"image/jpeg"!=t.type&&"image/png"!=t.type?alert("Incorrect file type"):n():alert("File is too large, needs to be below 2MB.")}function saveImageToS3(e){var n={expiration:"2014-10-31T00:00:00Z",conditions:[{bucket:"sister-test"},["starts-with","$key",""],{acl:"public-read"},["starts-with","$Content-Type",""],["content-length-range",0,1048576]]},t={policyDocument:JSON.stringify(n)},a=JSON.stringify({method:"es.getSignatureForS3",params:[t],auth:null,id:0,jsonrpc:"2.0s"});$.ajax({url:"http://api.sister.tv/api/jsonrpc/",type:"POST",contentType:"application/json",data:a,dataType:"json",success:function(n){console.log("got the result policy and sig",n),setS3Data(e,n.result.policy,n.result.signature),uploadToS3(n.result.policy,n.result.signature)}})}function sendFile(e){var n=new FormData($("#dragDropUploadForm_")[0]);n.append("files",e);var t=new XMLHttpRequest;t.open("POST","https://sister-test.s3.amazonaws.com/",!0),t.onload=function(){200===t.status?console.log("DRAG AND DROP SUCCESSFUL"):console.log("NOPE NOPE NOPE NOPE NOPE")},t.send(n)}function setS3Data(e,n,t){var a=document.getElementById("dat").file.name,o="public-read",r="0KMZHPQ56ZMG07Q3HG02",o="public-read",p=new FormData;p.append("key",a),p.append("acl",o),p.append("Content-Type","image/jpeg"),p.append("AWSAccessKeyId",r),p.append("policy",n),p.append("signature",t),p.append("file",$("#dat").attr("src"));var s=new XMLHttpRequest;s.open("POST","https://sister-test.s3.amazonaws.com/",!0),s.onload=function(){200===s.status?console.log("DRAG AND DROP SUCCESSFUL"):console.log("NOPE NOPE NOPE NOPE NOPE")},s.send(p)}function uploadToS3(e,n){var t=$("#bannerFileSelect").val().split("\\")[$("#bannerFileSelect").val().split("\\").length-1],a=t,o="public-read",r="0KMZHPQ56ZMG07Q3HG02";if(0!=a){$("#bannerUploadForm").prepend("<input type='hidden' name='Content-Type' value='image/jpg'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='signature' value='"+n+"'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='policy' value='"+e+"'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='acl' value='"+o+"'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='AWSAccessKeyId' value='"+r+"'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='key' value='"+a+"'>");var p=new FormData(document.getElementById("bannerUploadForm")),s=new XMLHttpRequest;s.addEventListener("load",function(){console.log("========SINGLE FILE UPLOAD=========")},!1),s.open("POST","https://sister-test.s3.amazonaws.com/",!0),s.send(p)}else console.log("NOTHING TO UPLOAD FROM READER")}var dropzone;dropzone=document.getElementById("dropzone"),dropzone.addEventListener("dragenter",dragenter,!1),dropzone.addEventListener("dragover",dragover,!1),dropzone.addEventListener("drop",drop,!1);
