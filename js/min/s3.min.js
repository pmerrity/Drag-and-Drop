function saveImageToS3(){var e={expiration:"2014-10-31T00:00:00Z",conditions:[{bucket:"sister-test"},["starts-with","$key",""],{acl:"public-read"},["starts-with","$Content-Type",""],["content-length-range",0,1048576]]},n={policyDocument:JSON.stringify(e)},t=JSON.stringify({method:"es.getSignatureForS3",params:[n],auth:null,id:0,jsonrpc:"2.0s"});$.ajax({url:"http://api.sister.tv/api/jsonrpc/",type:"POST",contentType:"application/json",data:t,dataType:"json",success:function(e){console.log("got the result policy and sig",e),uploadDragToS3(e.result.policy,e.result.signature),uploadToS3(e.result.policy,e.result.signature)}})}function uploadDragToS3(e,n){var t=$(".droppedItem > img");console.log(t),t.each(function(t,a){console.log(t,a,this.id);{var o=this.id,p="public-read",r="0KMZHPQ56ZMG07Q3HG02";a.getAttribute("src")}$("body").prepend('<form id="dragDropUploadForm_'+t+'"></form>');var i=new FormData(document.getElementById("dragDropUploadForm_"+t));i.append("key",o),i.append("acl",p),i.append("Content-Type","image/jpeg"),i.append("AWSAccessKeyId",r),i.append("policy",e),i.append("signature",n),i.append("file",dataURItoBlob(a.getAttribute("src")));var l=new XMLHttpRequest;l.open("POST","https://sister-test.s3.amazonaws.com/",!0),l.send(i)})}function dataURItoBlob(e){for(var n=atob(e.split(",")[1]),t=[],a=0;a<n.length;a++)t.push(n.charCodeAt(a));return new Blob([new Uint8Array(t)],{type:"image/jpeg"})}function uploadToS3(e,n){var t=$("#bannerFileSelect").val().split("\\")[$("#bannerFileSelect").val().split("\\").length-1],a=t,o="public-read",p="0KMZHPQ56ZMG07Q3HG02";if(0!=a){$("#bannerUploadForm").prepend("<input type='hidden' name='Content-Type' value='image/jpg'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='signature' value='"+n+"'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='policy' value='"+e+"'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='acl' value='"+o+"'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='AWSAccessKeyId' value='"+p+"'>"),$("#bannerUploadForm").prepend("<input type='hidden' name='key' value='"+a+"'>");var r=new FormData(document.getElementById("bannerUploadForm"));console.log($("#bannerUploadForm"));var i=new XMLHttpRequest;i.addEventListener("load",function(){console.log("========SINGLE FILE UPLOAD=========")},!1),i.open("POST","https://sister-test.s3.amazonaws.com/",!0),i.send(r)}else console.log("NOTHING TO UPLOAD FROM READER")}$("#selectFile").click(function(){saveImageToS3()});
